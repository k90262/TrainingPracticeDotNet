<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!--head block內不用對稱-->
    <script src="jquery-3.4.1.min.js"></script>
    <script>
        $(function () {
            $("#btnAdd").click(function () {
                var obj = {
                    name: $("#name").val(),
                    phone: $("#phone").val(),
                    age: $("#age").val()
                }
                var db;
                var reqDB = indexedDB.open("DB123"); // google indexdb -> MDN
                reqDB.onupgradeneeded = function (event) {
                    var db = event.target.result;
                    if (event.oldVersion < 1) { // google: indexeddb oldversion -> MDN
                        var objectStore = db.createObjectStore("contacts", { keyPath: "name" });
                    }

                };
                reqDB.onerror = function (event) {
                    alert("Why didn't you allow my web app to use IndexedDB?!");
                };
                reqDB.onsuccess = function (event) {
                    db = reqDB.result;
                    // alert(db.name);

                    var transaction = db.transaction(["contacts"], "readwrite");
                    // Do something when all the data is added to the database.
                    // transaction.oncomplete = function (event) {
                    //     console.log("All done!");
                    // };

                    // transaction.onerror = function (event) {
                    //     // Don't forget to handle errors!
                    // };

                    var objectStore = transaction.objectStore("contacts");
                    var reqAdd = objectStore.add(obj);
                    reqAdd.onsuccess = function (event) {
                        alert("ADD SUCCESS");
                    };
                    reqAdd.onerror = function (event) {
                        alert("ADD ERROR");
                    };
                };

            });
        });
    </script>
</head>

<body>
    Name: <input type="text" id="name" value="test" /> <br />
    Phone: <input type="text" id="phone" /> <br />
    age: <input type="text" id="age" /> <br />
    <button id="btnAdd">新增聯絡人</button>
</body>

</html>